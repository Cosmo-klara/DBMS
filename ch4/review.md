# 关系数据库标准语言SQL

## SQL 的分类与特点

### 功能

SQL语言集**数据查询、数据操纵、数据定义和数据控制**功能于一体，充分体现了关系数据语言的特点和优点

### 分类

+ 数据定义语言, DDL: 定义表, 视图和索引
+ 数据操纵语言, DML: 查询, 插入, 删除和修改
+ 数据控制语言, DCL: 访问权限管理, 事务管理
+ 嵌入式SQL: SQL嵌入到程序语言中的使用

### 特点

+ 综合统一
+ 高度非过程化
+ 面向集合的操作方式
+ 以同一种语法结构提供多种使用方式
    + 作为独立的语言
    + 作为嵌入式语言
+ 不同方式下，SQL的语法结构基本上一致，提供了极大的灵活性和方便性

## SQL 的系统结构

SQL支持数据库的三级模式结构, 在 SQL 中, 关系模式为基本表, 基本表的集合形成数据库模式, 对应三级模式的全局数据逻辑结构; 一个表在物理上和一个存储文件db相对应, 所有存储文件的集合为物理数据库; 局部逻辑由视图组成, 是定义在一个或多个表上的表, 本身不存储在数据库中.

![](./img/4-1.png)

## 索引

索引是为了提高查询速度而对表字段附加的一种标识, 是单独的、物理的对数据库表中一列或多列的值进行排序的一种数据存储结构

建立索引是加快查询速度的有效手段

 一般来说，**包含许多重复值的列**不适合建立索引

依据**索引的顺序和数据库的物理存储顺序是否相同**，索引分为两类：聚簇索引、非聚簇索引

+ 非聚集索引: 数据存储在一个地方，索引存储在另一个地方，索引带有指针指向数据的存储位置
+ 聚簇索引: 聚簇索引对表的物理数据页中的数据按列进行排序，然后再重新存储到磁盘上，即聚集索引与数据是混为一体的，它的叶节点中存储的是实际的数据
    + 聚簇索引确定表中数据的物理顺序。一个表只能包含一个聚簇索引。但该索引可以包含多个列（组合索引）。
    + 聚簇索引适用于：很少对基表进行增删操作；很少对其中的变长列进行修改操作
    + 聚簇索引对于那些经常要搜索范围值的列特别有效

优点:
+ 对某个属性使用索引能极大提高对该属性上的值的检索效率，使用到该属性时，还可以加快连接
缺点:
+ 带索引的表在数据库中会占据更多的空间。
+ 维护索引的代价，对数据进行插入、更新、删除操作的命令所花费的时间会更长。

应评估两个因素：**数据的性质和基于表的查询的性质**, 来决定是否创建索引，应确保对性能的提高程度大于在存储空间和处理资源方面的代价

+ 如果某个关系的查询操作对它的更新操作多，那么建立在该关系上的索引具有较高的效率。

+ 对于经常和查询where子句中的常量作比较的属性，以及频繁出现在连接条件中的属性应该建立索引

+ 更新操作频繁，创建索引要谨慎。需要仔细估算更新和查询数量的相对比例来决定索引的使用

+ 一般来说，**包含许多重复值的列, 经常更新的列**不适合建立索引

## 聚集函数与集合查询

+ 用集函数实现子查询通常比直接用ANY或ALL查询效率要高，因为前者通常能够减少比较次数

+ 并(UNION)、交(INTERSECT)、差(MINUS)

## 视图

DBMS实现视图更新的方法

+ 视图实体化法（View Materialization）
    + 有效性检查：检查所查询的视图是否存在
    + 执行视图定义，将视图临时实体化，生成临时表
    + 查询视图转换为查询临时表
    + 查询完毕删除被实体化的视图(临时表)
+ 视图消解法（View Resolution）
    + 进行有效性检查，检查查询的表、视图等是否存在。如果存在，则从数据字典中取出视图的定义
    + 把视图定义中的子查询与用户的查询结合起来，转换成等价的对基本表的查询
    + 执行修正后的查询

数据库中实际存储的是基本表，视图是建立在一个或多个基本表上的虚表。不同的用户通过视图可以对数据库的部分数据进行查询和更新操作。视图提供了用户从不同角度观察数据库的方法。

在视图定义中的 SELECT 语句不能包含 ORDER BY

### 视图的优点

+ 视图提供了逻辑数据独立性
+ 简化了用户视图
+ 视图使用户以不同角度看待相同的数
+ 视图提供了安全保护功能

## 嵌入式SQL

游标是系统为用户开设的一个数据缓冲区, 用来存放SQL语句的执行结果, 协调面向集合和面向记录两种不同的处理方式
+ 结果集
+ 指向结果集某一行的指针

### 将SQL语言嵌入到主语言需要解决的问题

+ 编译嵌入主语言的SQL语句成为可执行代码
+ 数据库和主语言程序间的通信
+ 数据库和主语言程序间的数据交换
+ 需要协调面向集合和面向记录两种不同的处理方式





